/**
 * Tests du Module Client (Sub-Partner)
 * 
 * Ce fichier teste les op√©rations sub-partner:
 * - Lister les clients
 * - Cr√©er un client
 * - Obtenir les d√©tails du client
 * - Obtenir le solde du client
 */

require('dotenv').config();
const { NowPayments } = require('../../src');

const np = new NowPayments({
    apiKey: process.env.NOWPAYMENTS_API_KEY,
    ipnSecret: process.env.NOWPAYMENTS_IPN_SECRET,
    email: process.env.NOWPAYMENTS_EMAIL,
    password: process.env.NOWPAYMENTS_PASSWORD,
    sandbox: process.env.SANDBOX_MODE === 'true'
});

async function runCustomerTests() {
    console.log('‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó');
    console.log('‚ïë         TESTS DU MODULE CLIENT                   ‚ïë');
    console.log('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n');

    let testCustomerId = null;

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // LISTER LES CLIENTS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    console.log('üìã LISTE DES CLIENTS');
    console.log('‚îÄ'.repeat(50));
    try {
        const result = await np.customers.list();
        console.log(`   Total de clients: ${result.customers?.length || 0}`);
        if (result.customers && result.customers.length > 0) {
            console.log('   5 premiers clients:');
            result.customers.slice(0, 5).forEach(c => {
                console.log(`   - ${c.id}: ${c.name || 'Sans nom'}`);
            });
            testCustomerId = result.customers[0].id;
        }
        console.log('   ‚úÖ Test de listage r√©ussi\n');
    } catch (error) {
        console.log(`   ‚ùå Erreur: ${error.message}\n`);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // CR√âER UN CLIENT
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    console.log('‚ûï CR√âER NOUVEAU CLIENT');
    console.log('‚îÄ'.repeat(50));
    try {
        const newCustomer = await np.customers.create({
            name: `test_customer_${Date.now()}`
        });
        console.log(`   ID du client: ${newCustomer.id}`);
        console.log(`   Nom du client: ${newCustomer.name}`);
        testCustomerId = newCustomer.id;
        console.log('   ‚úÖ Test de cr√©ation r√©ussi\n');
    } catch (error) {
        console.log(`   ‚ùå Erreur: ${error.message}\n`);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // D√âTAILS DU CLIENT
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    console.log('üîç D√âTAILS DU CLIENT');
    console.log('‚îÄ'.repeat(50));
    if (testCustomerId) {
        try {
            const details = await np.customers.get(testCustomerId);
            console.log(`   ID: ${details.id}`);
            console.log(`   Nom: ${details.name || 'Non d√©fini'}`);
            console.log(`   Cr√©√©: ${details.created_at || 'Non disponible'}`);
            console.log('   ‚úÖ Test des d√©tails r√©ussi\n');
        } catch (error) {
            console.log(`   ‚ùå Erreur: ${error.message}\n`);
        }
    } else {
        console.log('   ‚ö†Ô∏è Pas d\'ID de client pour tester\n');
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // SOLDE DU CLIENT
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    console.log('üí∞ SOLDE DU CLIENT');
    console.log('‚îÄ'.repeat(50));
    if (testCustomerId) {
        try {
            const balance = await np.customers.getBalance(testCustomerId);
            console.log('   Soldes:');
            if (balance && typeof balance === 'object') {
                Object.keys(balance).forEach(currency => {
                    console.log(`   - ${currency}: ${balance[currency]}`);
                });
            }
            console.log('   ‚úÖ Test de solde r√©ussi\n');
        } catch (error) {
            console.log(`   ‚ùå Erreur: ${error.message}\n`);
        }
    } else {
        console.log('   ‚ö†Ô∏è Pas d\'ID de client pour tester\n');
    }

    console.log('‚ïê'.repeat(50));
    console.log('‚úÖ Tests du module client termin√©s');
    console.log('‚ïê'.repeat(50));
}

runCustomerTests().catch(console.error);
